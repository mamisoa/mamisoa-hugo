{{ define "main" }}
<!-- Page Appointments - Embed Cal.com -->
<div class="appointments-page">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-12 col-xl-10">
        <!-- Breadcrumbs SEO -->
        <nav aria-label="breadcrumb" class="appointments-breadcrumb">
          <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
              <a itemprop="item" href="{{ .Site.BaseURL | relLangURL }}">
                <span itemprop="name">{{ T "home" | default "Accueil" }}</span>
              </a>
              <meta itemprop="position" content="1" />
            </li>
            <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
              <span itemprop="name">{{ .Title }}</span>
              <meta itemprop="position" content="2" />
            </li>
          </ol>
        </nav>
        
        <!-- H1 SEO Title -->
        <h1 class="appointments-main-title">{{ .Title }}</h1>
        
        <!-- Appointments Container -->
        <div class="appointments-container">
          <!-- Slides Container -->
          <div class="appointments-slides-container">
            <!-- Step 1: Choix du médecin -->
            <div class="appointments-slide" id="page-step-doctor" data-step="1">
              <div class="slide-content">
                <div class="step-icon">
                  <i class="fas fa-user-md"></i>
                </div>
                <h2 class="step-title">{{ T "appointments_choose_doctor" | default "Choisissez votre médecin" }}</h2>
                <p class="step-subtitle">{{ T "appointments_which_doctor" | default "Quel ophtalmologiste souhaitez-vous consulter ?" }}</p>
                
                <div class="doctors-grid">
                  {{ range .Site.Params.doctors }}
                  {{/* Map doctor id to description translation key */}}
                  {{ $descKey := "" }}
                  {{ if eq .id "m.andriantafika" }}{{ $descKey = "doctor_andriantafika_description" }}{{ end }}
                  {{ if eq .id "m.lienart" }}{{ $descKey = "doctor_lienart_description" }}{{ end }}
                  <div class="doctor-card {{ if not .enabled }}doctor-disabled{{ end }}" 
                       data-doctor-id="{{ .id }}"
                       data-doctor-name="{{ .name }}"
                       data-doctor-photo="{{ .photo }}"
                       data-has-multiple="{{ if gt (len .consultations) 1 }}true{{ else }}false{{ end }}"
                       {{ if not .enabled }}data-disabled="true"{{ end }}>
                    <div class="doctor-card-inner">
                      <div class="doctor-avatar">
                        {{ if .photo }}
                        <img src="{{ .photo }}" alt="{{ .name }}" class="doctor-avatar-img">
                        {{ else }}
                        <i class="fas fa-user-md"></i>
                        {{ end }}
                      </div>
                      <div class="doctor-info">
                        <h4 class="doctor-name">{{ .name }}</h4>
                        <p class="doctor-specialty">{{ T "doctor_specialty_ophthalmologist" | default .specialty }}</p>
                        <p class="doctor-description">{{ T $descKey | default .description }}</p>
                        {{ if not .enabled }}
                        <span class="badge badge-secondary mt-2">{{ T "appointments_coming_soon" | default "Bientôt disponible" }}</span>
                        {{ end }}
                      </div>
                      <div class="doctor-arrow">
                        <i class="fas fa-chevron-right"></i>
                      </div>
                    </div>
                    <!-- Hidden consultations data -->
                    <div class="doctor-consultations-data" style="display: none;">
                      {{ range .consultations }}
                      {{/* Map consultation id to translation key */}}
                      {{ $consultKey := "" }}
                      {{ if eq .id "routine" }}{{ $consultKey = "consultation_routine" }}{{ end }}
                      {{ if eq .id "urgente" }}{{ $consultKey = "consultation_urgent" }}{{ end }}
                      {{ if eq .id "enfants" }}
                        {{ if strings.Contains .name "4" }}{{ $consultKey = "consultation_child_4" }}{{ else }}{{ $consultKey = "consultation_child_5" }}{{ end }}
                      {{ end }}
                      {{ if eq .id "chauffeur" }}{{ $consultKey = "consultation_driver" }}{{ end }}
                      {{ if eq .id "glaucome" }}{{ $consultKey = "consultation_glaucoma" }}{{ end }}
                      {{ if eq .id "dry-eyes" }}{{ $consultKey = "consultation_dry_eyes" }}{{ end }}
                      {{ if eq .id "avis-operatoire" }}{{ $consultKey = "consultation_surgical_opinion" }}{{ end }}
                      <span data-id="{{ .id }}" data-name="{{ T $consultKey | default .name }}" data-callink="{{ .calLink }}"></span>
                      {{ end }}
                    </div>
                  </div>
                  {{ end }}
                </div>
                
                <!-- SEO Content -->
                <div class="appointments-seo-content">
                  <p>{{ T "appointments_seo_text" | default "Le Centre Médical Bruxelles-Schuman vous permet de prendre rendez-vous en ligne avec nos ophtalmologues. Situé Avenue de Cortenbergh 66 à Bruxelles, notre centre propose des consultations générales, des examens spécialisés (glaucome, yeux secs, chirurgie réfractive) ainsi que des consultations pédiatriques. Réservez votre créneau en quelques clics." }}</p>
                </div>
              </div>
            </div>

            <!-- Step 2: Type de consultation -->
            <div class="appointments-slide" id="page-step-consultation" data-step="2">
              <div class="slide-content">
                <button class="btn-back" id="pageBackToDoctor">
                  <i class="fas fa-arrow-left mr-2"></i>{{ T "appointments_back_doctor" | default "Retour au choix du médecin" }}
                </button>
                
                <div class="step-doctor-photo" id="pageStepDoctorPhoto">
                  <img src="" alt="" class="step-doctor-photo-img">
                </div>
                <h2 class="step-title">{{ T "appointments_consultation_type" | default "Type de consultation" }}</h2>
                <p class="step-subtitle page-selected-doctor-name"></p>
                <p class="step-description">{{ T "appointments_which_type" | default "Quel type de consultation souhaitez-vous ?" }}</p>
                
                <div class="consultations-grid" id="pageConsultationsContainer">
                  <!-- Dynamically populated -->
                </div>
              </div>
            </div>

            <!-- Step 3: Calendrier Cal.com -->
            <div class="appointments-slide" id="page-step-calendar" data-step="3">
              <div class="slide-content slide-content-calendar">
                <div class="calendar-header">
                  <button class="btn-back" id="pageBackToConsultation">
                    <i class="fas fa-arrow-left mr-2"></i>{{ T "appointments_back" | default "Retour" }}
                  </button>
                  <div class="calendar-info">
                    <div class="calendar-info-item">
                      <i class="fas fa-user-md"></i>
                      <span id="pageCalendarDoctorName"></span>
                    </div>
                    <div class="calendar-info-divider"></div>
                    <div class="calendar-info-item">
                      <i class="fas fa-stethoscope"></i>
                      <span id="pageCalendarConsultationType"></span>
                    </div>
                  </div>
                  <button class="btn-change-doctor" id="pageChangeDoctor">
                    {{ T "appointments_change_doctor" | default "Changer de médecin" }}
                  </button>
                </div>
                
                <div class="calendar-embed-container">
                  <div class="calendar-loading" id="pageCalendarLoading">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">{{ T "appointments_loading" | default "Chargement..." }}</span>
                    </div>
                    <p>{{ T "appointments_loading_calendar" | default "Chargement du calendrier..." }}</p>
                  </div>
                  <iframe id="pageCalendarIframe" 
                          src="" 
                          title="{{ T "appointments_calendar_title" | default "Calendrier de rendez-vous" }}"
                          allow="camera; microphone; payment"
                          loading="lazy">
                  </iframe>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Appointments Page Styles -->
<style>
/* SEO Elements - H1 and Breadcrumbs */
.appointments-main-title {
  color: white;
  font-family: 'Maven Pro', sans-serif;
  font-weight: 600;
  font-size: 2.5rem;
  text-align: center;
  margin-bottom: 1.5rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.appointments-breadcrumb {
  padding: 0.5rem 1rem;
  margin-bottom: 1rem;
}

.appointments-breadcrumb .breadcrumb {
  background: transparent;
  margin: 0;
  padding: 0;
  justify-content: center;
}

.appointments-breadcrumb .breadcrumb-item a {
  color: #B3E5FC;
  text-decoration: none;
  transition: color 0.2s ease;
}

.appointments-breadcrumb .breadcrumb-item a:hover {
  color: white;
}

.appointments-breadcrumb .breadcrumb-item.active {
  color: white;
}

.appointments-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
  color: rgba(255, 255, 255, 0.5);
}

.appointments-seo-content {
  margin-top: 2rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  color: #BBDEFB;
  font-size: 0.95rem;
  line-height: 1.6;
  max-width: 800px;
  text-align: center;
}

.appointments-seo-content p {
  margin: 0;
}

/* Hide @RDV menu item on appointments page (user is already here) */
.navbar-nav .nav-item a[data-target="#appointmentModal"] {
  display: none !important;
}

/* Also hide by checking the href="#" with @rdv text */
.navbar-nav .nav-item a[href="#"] .blog-menu {
  display: none !important;
}

/* Alternative: hide parent li if link contains @rdv, @book, @boek */
.navbar-nav .nav-item:has(a[href="#"]) {
  display: none !important;
}

/* Appointments Page Container */
.appointments-page {
  background: #1E88E5; /* Same as appointments-container for seamless look */
  min-height: calc(100vh - 80px);
  padding: 2rem 0;
}

.appointments-container {
  background: #1E88E5;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
  min-height: calc(100vh - 150px);
}

/* Slides Container */
.appointments-slides-container {
  display: flex;
  width: 300%;
  min-height: calc(100vh - 150px);
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.appointments-slide {
  width: 33.333%;
  min-height: 100%;
  overflow-y: auto;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
}

.slide-content {
  padding: 3rem 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.slide-content-calendar {
  padding: 1.5rem;
  height: 100%;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

/* Step Icons */
.step-icon {
  width: 120px;
  height: 120px;
  background: linear-gradient(145deg, #26A69A, #00796B);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 2rem;
  box-shadow: 20px 20px 60px #186bb5, -20px -20px 60px #24a5ff;
}

.step-icon i {
  font-size: 3rem;
  color: white;
}

.step-icon-blue {
  background: linear-gradient(145deg, #1E88E5, #1565C0);
}

.step-doctor-photo {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  overflow: hidden;
  margin-bottom: 2rem;
  box-shadow: 20px 20px 60px #186bb5, -20px -20px 60px #24a5ff;
  border: 4px solid rgba(255, 255, 255, 0.3);
}

.step-doctor-photo-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.step-title {
  color: white;
  font-family: 'Maven Pro', sans-serif;
  font-weight: 600;
  font-size: 2rem;
  margin-bottom: 0.75rem;
  text-align: center;
}

.step-subtitle {
  color: #E3F2FD;
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  text-align: center;
}

.step-description {
  color: #BBDEFB;
  font-size: 1.1rem;
  margin-bottom: 2.5rem;
  text-align: center;
}

.page-selected-doctor-name {
  color: #4DB6AC;
  font-weight: 600;
  font-size: 1.4rem;
}

/* Doctors Grid */
.doctors-grid {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  width: 100%;
  max-width: 800px;
}

.doctor-card {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.doctor-card:hover:not(.doctor-disabled) {
  background: rgba(255, 255, 255, 0.15);
  border-color: #4DB6AC;
  transform: translateX(8px);
}

.doctor-card.doctor-disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.doctor-card-inner {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.doctor-avatar {
  width: 80px;
  height: 80px;
  min-width: 80px;
  background: linear-gradient(145deg, #26A69A, #00796B);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.doctor-avatar i {
  font-size: 2rem;
  color: white;
}

.doctor-avatar-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}

.doctor-info {
  flex: 1;
}

.doctor-name {
  color: white;
  font-family: 'Maven Pro', sans-serif;
  font-weight: 600;
  font-size: 1.4rem;
  margin-bottom: 0.25rem;
}

.doctor-specialty {
  color: #B3E5FC;
  font-size: 1rem;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.doctor-description {
  color: #BBDEFB;
  font-size: 0.95rem;
  line-height: 1.4;
  margin-bottom: 0;
}

.doctor-arrow {
  color: rgba(255, 255, 255, 0.5);
  font-size: 1.5rem;
  transition: all 0.3s ease;
}

.doctor-card:hover:not(.doctor-disabled) .doctor-arrow {
  color: #4DB6AC;
  transform: translateX(5px);
}

/* Consultations Grid */
.consultations-grid {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
  width: 100%;
  max-width: 700px;
}

.consultation-card {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1.5rem 1.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.consultation-card:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: #1E88E5;
  transform: translateX(8px);
}

.consultation-card-inner {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.consultation-icon {
  width: 55px;
  height: 55px;
  background: linear-gradient(145deg, #1E88E5, #1565C0);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.consultation-icon i {
  font-size: 1.4rem;
  color: white;
}

.consultation-name {
  color: white;
  font-family: 'Maven Pro', sans-serif;
  font-weight: 600;
  font-size: 1.2rem;
  margin: 0;
}

.consultation-arrow {
  color: rgba(255, 255, 255, 0.5);
  font-size: 1.25rem;
  transition: all 0.3s ease;
}

.consultation-card:hover .consultation-arrow {
  color: #64B5F6;
  transform: translateX(5px);
}

/* Back Button */
.btn-back {
  align-self: flex-start;
  background: transparent;
  border: none;
  color: #E3F2FD;
  font-size: 1.1rem;
  cursor: pointer;
  padding: 0.75rem 1.25rem;
  margin-bottom: 2rem;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.btn-back:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

/* Calendar Step */
.calendar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 12px;
  margin-bottom: 1.5rem;
  flex-wrap: nowrap;
  gap: 1rem;
}

.calendar-header .btn-back {
  margin-bottom: 0;
  white-space: nowrap;
}

.calendar-info {
  display: flex;
  align-items: center;
  gap: 1.25rem;
}

.calendar-info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: white;
  font-size: 1rem;
}

.calendar-info-item i {
  color: #4DB6AC;
}

.calendar-info-divider {
  width: 1px;
  height: 28px;
  background: rgba(255, 255, 255, 0.3);
}

.btn-change-doctor {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 0.6rem 1.25rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.95rem;
}

.btn-change-doctor:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
}

.calendar-embed-container {
  position: relative;
  flex: 1;
  background: white;
  border-radius: 12px;
  overflow: hidden;
  min-height: 600px;
  width: 100%;
}

.calendar-loading {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: white;
  z-index: 10;
}

.calendar-loading p {
  margin-top: 1rem;
  color: #1565C0;
  font-size: 1.1rem;
}

.calendar-loading.hidden {
  display: none;
}

#pageCalendarIframe {
  width: 100%;
  height: 100%;
  min-height: 600px;
  border: none;
  display: block;
}

/* Responsive */
@media (max-width: 992px) {
  .appointments-page {
    padding: 1rem 0;
  }
  
  .appointments-container {
    border-radius: 12px;
    min-height: calc(100vh - 100px);
  }
  
  .slide-content {
    padding: 2rem 1.5rem;
  }
  
  .step-icon {
    width: 100px;
    height: 100px;
  }
  
  .step-icon i {
    font-size: 2.5rem;
  }
  
  .step-title {
    font-size: 1.75rem;
  }
}

@media (max-width: 768px) {
  .appointments-page {
    padding: 0.5rem 0;
  }
  
  .appointments-container {
    border-radius: 8px;
  }
  
  .slide-content {
    padding: 1.5rem 1rem;
  }
  
  .doctor-card-inner {
    flex-direction: column;
    text-align: center;
  }
  
  .doctor-arrow {
    display: none;
  }
  
  .calendar-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .calendar-info {
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .btn-change-doctor {
    width: 100%;
    text-align: center;
  }
  
  .calendar-embed-container {
    min-height: 450px;
  }
  
  #pageCalendarIframe {
    min-height: 450px;
  }
}

/* SVG Transition - Override to match appointments container colors */
.appointments-svg-transition {
  background-color: #1E88E5; /* Same as appointments-container background */
}

.appointments-svg-transition svg path {
  fill: #1565C0; /* Same as footer/contact section background */
}
</style>

<!-- Appointments Page JavaScript -->
<script>
(function() {
  'use strict';
  
  const CALCOM_BASE_URL = '{{ .Site.Params.calcomBaseUrl | default "https://schuman.ophtalmologiste.be" }}';
  
  let currentStep = 1;
  let selectedDoctor = null;
  let selectedConsultation = null;
  
  // DOM Elements
  let slidesContainer, doctorCards, consultationsContainer, calendarIframe, calendarLoading;
  let backToDoctor, backToConsultation, changeDoctor;
  let calendarDoctorName, calendarConsultationType, selectedDoctorNameEl;
  
  function init() {
    slidesContainer = document.querySelector('.appointments-slides-container');
    doctorCards = document.querySelectorAll('.appointments-page .doctor-card');
    consultationsContainer = document.getElementById('pageConsultationsContainer');
    calendarIframe = document.getElementById('pageCalendarIframe');
    calendarLoading = document.getElementById('pageCalendarLoading');
    backToDoctor = document.getElementById('pageBackToDoctor');
    backToConsultation = document.getElementById('pageBackToConsultation');
    changeDoctor = document.getElementById('pageChangeDoctor');
    calendarDoctorName = document.getElementById('pageCalendarDoctorName');
    calendarConsultationType = document.getElementById('pageCalendarConsultationType');
    selectedDoctorNameEl = document.querySelector('.page-selected-doctor-name');
    
    // Event listeners for doctor cards
    doctorCards.forEach(card => {
      card.addEventListener('click', function() {
        if (this.dataset.disabled === 'true') return;
        handleDoctorSelect(this);
      });
    });
    
    // Back buttons
    if (backToDoctor) {
      backToDoctor.addEventListener('click', function() {
        goToStep(1);
      });
    }
    
    if (backToConsultation) {
      backToConsultation.addEventListener('click', function() {
        if (selectedDoctor && selectedDoctor.hasMultiple) {
          goToStep(2);
        } else {
          goToStep(1);
        }
      });
    }
    
    if (changeDoctor) {
      changeDoctor.addEventListener('click', function() {
        resetPage();
        goToStep(1);
      });
    }
    
    // Handle iframe load
    if (calendarIframe) {
      calendarIframe.addEventListener('load', function() {
        if (calendarIframe.src && calendarIframe.src !== '' && calendarIframe.src !== 'about:blank') {
          calendarLoading.classList.add('hidden');
        }
      });
    }
  }
  
  function handleDoctorSelect(cardElement) {
    const doctorId = cardElement.dataset.doctorId;
    const doctorName = cardElement.dataset.doctorName;
    const doctorPhoto = cardElement.dataset.doctorPhoto;
    const hasMultiple = cardElement.dataset.hasMultiple === 'true';
    
    // Get consultations data
    const consultationsData = cardElement.querySelector('.doctor-consultations-data');
    const consultations = [];
    consultationsData.querySelectorAll('span').forEach(span => {
      consultations.push({
        id: span.dataset.id,
        name: span.dataset.name,
        calLink: span.dataset.callink
      });
    });
    
    selectedDoctor = {
      id: doctorId,
      name: doctorName,
      photo: doctorPhoto,
      hasMultiple: hasMultiple,
      consultations: consultations
    };
    
    if (hasMultiple) {
      // Show consultation selection
      renderConsultations(consultations);
      goToStep(2);
    } else {
      // Go directly to calendar with first consultation
      selectedConsultation = consultations[0];
      loadCalendar();
      goToStep(3);
    }
  }
  
  function renderConsultations(consultations) {
    if (!consultationsContainer) return;
    
    selectedDoctorNameEl.textContent = selectedDoctor.name;
    
    // Update doctor photo in step 2
    const stepDoctorPhoto = document.getElementById('pageStepDoctorPhoto');
    if (stepDoctorPhoto && selectedDoctor.photo) {
      const img = stepDoctorPhoto.querySelector('img');
      img.src = selectedDoctor.photo;
      img.alt = selectedDoctor.name;
      stepDoctorPhoto.style.display = 'block';
    }
    
    consultationsContainer.innerHTML = consultations.map(c => `
      <div class="consultation-card" data-id="${c.id}" data-name="${c.name}" data-callink="${c.calLink}">
        <div class="consultation-card-inner">
          <div class="consultation-icon">
            <i class="fas fa-eye"></i>
          </div>
          <h4 class="consultation-name">${c.name}</h4>
        </div>
        <div class="consultation-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
    `).join('');
    
    // Add click listeners
    consultationsContainer.querySelectorAll('.consultation-card').forEach(card => {
      card.addEventListener('click', function() {
        selectedConsultation = {
          id: this.dataset.id,
          name: this.dataset.name,
          calLink: this.dataset.callink
        };
        loadCalendar();
        goToStep(3);
      });
    });
  }
  
  function loadCalendar() {
    if (!calendarIframe || !selectedConsultation) return;
    
    calendarLoading.classList.remove('hidden');
    
    // Update header info
    calendarDoctorName.textContent = selectedDoctor.name;
    calendarConsultationType.textContent = selectedConsultation.name;
    
    // Load iframe
    const calUrl = CALCOM_BASE_URL + '/' + selectedConsultation.calLink;
    calendarIframe.src = calUrl;
  }
  
  function goToStep(step) {
    currentStep = step;
    const offset = (step - 1) * -33.333;
    slidesContainer.style.transform = `translateX(${offset}%)`;
    
    // Scroll to top of container
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  function resetPage() {
    currentStep = 1;
    selectedDoctor = null;
    selectedConsultation = null;
    
    if (slidesContainer) {
      slidesContainer.style.transform = 'translateX(0)';
    }
    
    if (calendarIframe) {
      calendarIframe.src = '';
    }
    
    if (consultationsContainer) {
      consultationsContainer.innerHTML = '';
    }
    
    calendarLoading.classList.remove('hidden');
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

<!-- SVG Section Transition -->
<div class="svg-section appointments-svg-transition">
  <svg width="100%" height="100" viewBox="0 0 100 99" preserveAspectRatio="none">
    <path d="M0 0 L50 90 L100 0 V100 H0" fill="#1565C0" />
  </svg>
</div>
{{ end }}
